<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Auction Service</title>
    <link rel="stylesheet" href="/styles.css" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>
  <body>
    <nav class="nav">
      <div class="nav-links">
        <a href="#auth" class="nav-link" data-page="auth">Auth</a>
        <a href="#create" class="nav-link" data-page="create">Create Auction</a>
        <a href="#auctions" class="nav-link" data-page="auctions">My Auctions</a>
        <a href="#live" class="nav-link" data-page="live">Live Auction</a>
      </div>
      <div class="user-info" id="user-info" style="display: none;">
        <span>User:</span>
        <span id="user-name">-</span>
        <span>|</span>
        <span>Balance:</span>
        <span id="user-balance">-</span>
      </div>
    </nav>

    <!-- Auth Page -->
    <div id="page-auth" class="page">
      <div class="container">
        <h1>Authorization</h1>
        <div id="auth-error" class="error" style="display: none;"></div>
        <div id="auth-success" class="success" style="display: none;"></div>
        <div id="auth-form-container">
          <form id="auth-form">
            <div>
              <label for="auth-tg-id">Telegram User ID</label>
              <input id="auth-tg-id" type="number" min="1" step="1" placeholder="Enter your Telegram ID" required />
              <p class="helper">Enter your Telegram user ID to authorize</p>
            </div>
            <button type="submit">Authorize</button>
          </form>
        </div>
        <div style="margin-top: 24px; padding-top: 24px; border-top: 2px solid var(--ink);">
          <h3 style="font-size: 1.2rem; margin-bottom: 16px;">Balance Control</h3>
          <form id="balance-form">
            <div>
              <label for="balance-amount">Amount</label>
              <input id="balance-amount" type="number" min="1" step="0.01" placeholder="100" required />
            </div>
            <div style="display: flex; gap: 12px;">
              <button type="button" id="balance-increase" style="flex: 1;">Increase</button>
              <button type="button" id="balance-decrease" class="secondary" style="flex: 1;">Decrease</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Create Auction Page -->
    <div id="page-create" class="page">
      <div class="container">
        <h1>Create Auction</h1>
        <div id="create-error" class="error" style="display: none;"></div>
        <div id="create-success" class="success" style="display: none;"></div>
        <form id="create-form">
          <div>
            <label for="create-name">Auction Name (optional)</label>
            <input id="create-name" type="text" placeholder="Evening bid rush" />
          </div>
          <div>
            <label for="create-item">Item Name *</label>
            <input id="create-item" type="text" placeholder="Limited token drop" required />
          </div>
          <div class="field-row">
            <div>
              <label for="create-min-bid">Min Bid *</label>
              <input id="create-min-bid" type="number" min="0" step="0.01" required />
            </div>
            <div>
              <label for="create-winners">Winners Total *</label>
              <input id="create-winners" type="number" min="1" required />
            </div>
            <div>
              <label for="create-rounds">Rounds Count *</label>
              <input id="create-rounds" type="number" min="1" required />
            </div>
          </div>
          <div class="field-row">
            <div>
              <label for="create-first-round">First Round Duration (ms)</label>
              <input id="create-first-round" type="number" min="0" placeholder="optional" />
              <p class="helper">Leave empty to use default</p>
            </div>
            <div>
              <label for="create-round-duration">Round Duration (ms) *</label>
              <input id="create-round-duration" type="number" min="1" required />
            </div>
          </div>
          <div>
            <label for="create-start-datetime">Start Date/Time *</label>
            <input 
              id="create-start-datetime" 
              type="text" 
              placeholder="2026-12-31 00:00:00" 
              pattern="\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}"
              required 
            />
            <p class="helper">Format: YYYY-MM-DD HH:mm:ss (e.g., 2026-12-31 00:00:00)</p>
          </div>
          <button type="submit">Create Auction</button>
        </form>
      </div>
    </div>

    <!-- Live Auction Page -->
    <div id="page-live" class="page">
      <div class="live-container">
        <div class="live-header">
          <h2>
            <span class="ws-status disconnected" id="ws-status"></span>
            Live Auction View
          </h2>
          <form class="watch-form" id="watch-form">
            <input id="watch-auction-id" type="text" placeholder="Enter Auction ID" required />
            <button type="submit">Watch</button>
          </form>
        </div>

        <div id="live-content" style="display: none;">
          <div class="round-info">
            <div><strong>Auction:</strong> <span id="live-auction-name">-</span></div>
            <div><strong>Item:</strong> <span id="live-auction-item">-</span></div>
            <div><strong>Status:</strong> <span id="live-auction-status">-</span></div>
            <div><strong>Round:</strong> <span id="live-round-info">-</span></div>
            <div><strong>Remaining Items:</strong> <span id="live-remaining-items">-</span></div>
          </div>
          
          <div class="round-info" id="bots-control-section" style="display: none;">
            <h3 style="margin: 0 0 12px; font-size: 1.2rem;">Bot Control</h3>
            <div style="display: flex; gap: 12px;">
              <button type="button" id="bots-stop-btn" class="secondary">Stop Bots</button>
            </div>
            <div id="bots-status" class="helper" style="margin-top: 8px;"></div>
            <div class="helper" style="margin-top: 8px; color: var(--text-secondary);">
              Bots start automatically when auction begins
            </div>
          </div>
          
          <div class="timer" id="live-timer">--:--</div>
          
          <div class="round-info">
            <h3 style="margin: 0 0 12px; font-size: 1.2rem;">Top Bids</h3>
            <div class="top-bids" id="top-bids-list"></div>
          </div>
          
          <div class="bid-form-section">
            <h3 style="margin: 0 0 16px; font-size: 1.2rem;">Make a Bid</h3>
            <div class="helper" id="min-bid-info"></div>
            <form id="bid-form">
              <div class="field-row">
                <div>
                  <label for="bid-amount">Amount</label>
                  <input id="bid-amount" type="number" min="0" step="0.01" placeholder="100" required />
                </div>
                <div>
                  <label for="bid-idempotency">Idempotency Key</label>
                  <input id="bid-idempotency" type="text" placeholder="auto-generated" required />
                </div>
              </div>
              <div>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="bid-add-to-existing" />
                  <span>Add to existing bid</span>
                </label>
              </div>
              <button type="submit">Place Bid</button>
            </form>
          </div>
          
          <div class="round-info">
            <h3 style="margin: 0 0 12px; font-size: 1.2rem;">All Participants</h3>
            <div class="top-bids" id="all-bids-list"></div>
          </div>
          
          <div class="round-info" id="user-bid-info" style="display: none;">
            <h3 style="margin: 0 0 12px; font-size: 1.2rem;">Your Bid</h3>
            <div><strong>Amount:</strong> <span id="user-bid-amount">-</span></div>
            <div><strong>Place:</strong> <span id="user-bid-place">-</span></div>
          </div>
        </div>

        <div id="live-empty" class="empty">
          Enter an Auction ID above to watch it live
        </div>
      </div>
    </div>

    <!-- Auctions Management Page -->
    <div id="page-auctions" class="page">
      <div class="live-container">
        <div class="live-header">
          <h2>My Auctions</h2>
          <div id="auctions-error" class="error" style="display: none;"></div>
          <div id="auctions-success" class="success" style="display: none;"></div>
        </div>

        <div id="auctions-content">
          <div class="auctions-filters">
            <button type="button" class="filter-btn active" data-filter="all">All</button>
            <button type="button" class="filter-btn" data-filter="DRAFT">Drafts</button>
            <button type="button" class="filter-btn" data-filter="RELEASED">Released</button>
            <button type="button" class="filter-btn" data-filter="LIVE">Live</button>
            <button type="button" class="filter-btn" data-filter="FINISHED">Finished</button>
          </div>

          <div id="auctions-list" class="auctions-list"></div>
        </div>

        <div id="auction-detail" class="auction-detail" style="display: none;">
          <button type="button" class="back-btn" id="auction-detail-back">‚Üê Back</button>
          <div id="auction-detail-content"></div>
        </div>
      </div>
    </div>

    <!-- Edit Auction Page -->
    <div id="page-edit" class="page">
      <div class="container">
        <h1>Edit Auction</h1>
        <div id="edit-error" class="error" style="display: none;"></div>
        <div id="edit-success" class="success" style="display: none;"></div>
        <form id="edit-form">
          <div>
            <label for="edit-name">Auction Name (optional)</label>
            <input id="edit-name" type="text" placeholder="Evening bid rush" />
          </div>
          <div>
            <label for="edit-item">Item Name *</label>
            <input id="edit-item" type="text" placeholder="Limited token drop" required />
          </div>
          <div class="field-row">
            <div>
              <label for="edit-min-bid">Min Bid *</label>
              <input id="edit-min-bid" type="number" min="0" step="0.01" required />
            </div>
            <div>
              <label for="edit-winners">Winners Total *</label>
              <input id="edit-winners" type="number" min="1" required />
            </div>
            <div>
              <label for="edit-rounds">Rounds Count *</label>
              <input id="edit-rounds" type="number" min="1" required />
            </div>
          </div>
          <div class="field-row">
            <div>
              <label for="edit-first-round">First Round Duration (ms)</label>
              <input id="edit-first-round" type="number" min="0" placeholder="optional" />
              <p class="helper">Leave empty to use default</p>
            </div>
            <div>
              <label for="edit-round-duration">Round Duration (ms) *</label>
              <input id="edit-round-duration" type="number" min="1" required />
            </div>
          </div>
          <div>
            <label for="edit-start-datetime">Start Date/Time *</label>
            <input 
              id="edit-start-datetime" 
              type="text" 
              placeholder="2026-12-31 00:00:00" 
              pattern="\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}"
              required 
            />
            <p class="helper">Format: YYYY-MM-DD HH:mm:ss (e.g., 2026-12-31 00:00:00)</p>
          </div>
          <div style="display: flex; gap: 12px;">
            <button type="submit">Save Changes</button>
            <button type="button" class="secondary" id="edit-cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
